<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Hausaufgabe (Lehreransicht)</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="top-buttons" style="display: flex; justify-content: space-between;">
        <a href="/class_details_teacher/{{ class_info['id'] }}/{{ teacher_id }}" class="button">Zurück zur Klasse</a>
        <form action="/delete_homework" method="post" style="display:inline;" onsubmit="return confirm('Möchten Sie diese Hausaufgabe wirklich löschen?')">
            <input type="hidden" name="homework_id" value="{{ homework['id'] }}">
            <input type="hidden" name="class_id" value="{{ class_info['id'] }}">
            <input type="hidden" name="teacher_id" value="{{ teacher_id }}">
            <button type="submit" class="button danger">Hausaufgabe löschen</button>
        </form>
    </div>

    <h1>Hausaufgabe: {{ homework['title'] }}</h1>
    <h3>{{ homework['description'] }}</h3>
    <p>Erstellt am: {{ homework['date_created'] }}</p>

    <form id="homework-form">
        <ol>
            {% for question in questions %}
                <li>
                    <p>{{ question['question'] }}</p>
                    <ul>
                        {% for option in question['options'] %}
                            <li>
                                <label>
                                    <input type="radio" name="answer_{{ question['index'] }}" value="{{ option.index }}">
                                    {{ option.option }}
                                </label>
                            </li>
                        {% endfor %}
                    </ul>
                    <span id="result_{{ question['index'] }}"></span>
                    <p><strong>Richtige Antwort:</strong> {{ question['options'][question['correct_answer']] }}</p>
                    <p><strong>Erklärung:</strong> {{ question['explanation'] }}</p>
                </li>
            {% endfor %}
        </ol>
        <button type="button" onclick="checkAnswers()">Überprüfen</button>
    </form>

    <script>
        const correctAnswers = {{ correct_answers|tojson() }};
        const explanations = {{ explanations|tojson() }};

        function checkAnswers() {
            const form = document.getElementById('homework-form');
            const elements = form.elements;

            for (let el of elements) {
                if (el.name.startsWith('answer_')) {
                    const questionIndex = el.name.split('_')[1];
                    if (el.checked) {
                        const userAnswer = parseInt(el.value);
                        const correctAnswer = correctAnswers[questionIndex];
                        const resultSpan = document.getElementById('result_' + questionIndex);

                        if (userAnswer === correctAnswer) {
                            resultSpan.innerText = '✔️ Richtig!';
                            resultSpan.classList.add('correct');
                            resultSpan.classList.remove('incorrect');
                        } else {
                            resultSpan.innerText = `❌ Falsch! Erklärung: ${explanations[questionIndex]}`;
                            resultSpan.classList.add('incorrect');
                            resultSpan.classList.remove('correct');
                        }
                    }
                }
            }
        }
    </script>
</body>
</html>